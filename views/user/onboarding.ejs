  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'Travecy - Save and Plan Your Perfect Trip' %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="/assets/images/traveezy  bg no.png" />


    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
        color: #333;
      }

      .navbar-custom {
        background-color: #fff;
        padding: 15px 30px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }

      .logo img {
        width: auto;
        height: 50px;
        margin-left: 25px;
        vertical-align: middle;
      }

      .hero-section {
        background-color: #fff;
        padding: 60px 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
      }

      .hero-content {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 40px;
        flex-wrap: wrap;
      }

      .hero-illustration {
        flex: 0 0 300px;
        text-align: center;
      }

      .hero-illustration img {
        max-width: 100%;
        height: auto;
      }

      .hero-text {
        flex: 1;
        text-align: left;
      }

      .hero-text h1 {
        font-size: 32px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 15px;
      }

      .hero-text p {
        font-size: 16px;
        color: #666;
        line-height: 1.6;
      }

      .main-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 30px;
      }

      .location-section {
        background-color: #fff;
        padding: 30px;
        border-radius: 8px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }

      .location-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        font-size: 18px;
        font-weight: 600;
        color: #1a1a1a;
      }

      .location-header i {
        color: #20c997;
        margin-right: 10px;
        font-size: 20px;
      }

      .location-description {
        color: #666;
        font-size: 14px;
        margin-bottom: 20px;
        line-height: 1.6;
      }

      .search-box {
        position: relative;
        margin-bottom: 15px;
      }

      .search-box input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .search-box i {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #999;
      }

      #searchResults {
        z-index: 9999;
        max-height: 200px;
        overflow-y: auto;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .btn-enable {
        width: 100%;
        background-color: #20c997;
        color: white;
        border: none;
        padding: 12px;
        border-radius: 4px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .btn-enable:hover {
        background-color: #1aa179;
      }

      .interests-section,
      .dates-section,
      .notification-section {
        background-color: #fff;
        padding: 30px;
        border-radius: 8px;
        margin-bottom: 30px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }

      .interests-header {
        font-size: 18px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 20px;
      }

      .interests-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .tag {
        padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 20px;
        background-color: #f8f9fa;
        color: #666;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
      }

      .tag.active {
        background-color: #20c997;
        color: white;
        border-color: #20c997;
      }

      .tag:hover {
        border-color: #20c997;
      }

      .dates-header {
        display: flex;
        align-items: center;
        font-size: 18px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 20px;
      }

      .dates-header i {
        color: #20c997;
        margin-right: 10px;
        font-size: 20px;
      }

      .dates-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      .date-group {
        display: flex;
        flex-direction: column;
      }

      .date-label {
        font-size: 14px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 10px;
      }

      .date-input {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: #f8f9fa;
        color: #666;
        font-size: 14px;
      }

      .date-input i {
        margin-right: 10px;
        color: #999;
      }

      .notification-header {
        font-size: 18px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 20px;
      }

      .notification-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #eee;
      }

      .notification-content h4 {
        font-size: 14px;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 5px;
      }

      .notification-content p {
        font-size: 13px;
        color: #999;
      }

      .toggle-switch {
        position: relative;
        width: 50px;
        height: 28px;
        background-color: #ddd;
        border-radius: 14px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .toggle-switch.active {
        background-color: #20c997;
      }

      .toggle-switch::after {
        content: '';
        position: absolute;
        width: 24px;
        height: 24px;
        background-color: white;
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: left 0.3s;
      }

      .toggle-switch.active::after {
        left: 24px;
      }

      .footer-section {
        text-align: center;
        padding: 30px;
      }

      .btn-get-started {
        background-color: #20c997;
        color: white;
        border: none;
        padding: 12px 40px;
        border-radius: 4px;
        font-weight: 600;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
        margin-bottom: 15px;
      }

      .btn-get-started:hover {
        background-color: #1aa179;
      }

      .skip-link {
        display: block;
        color: #999;
        text-decoration: none;
        font-size: 14px;
        cursor: pointer;
        transition: color 0.3s;
      }

      .skip-link:hover {
        color: #666;
      }

      @media (max-width: 768px) {
        .hero-content {
          flex-direction: column;
          gap: 20px;
        }

        .hero-illustration {
          flex: 0 0 200px;
        }

        .hero-text {
          text-align: center;
        }

        .hero-text h1 {
          font-size: 24px;
        }

        .dates-row {
          grid-template-columns: 1fr;
        }

        .interests-tags {
          justify-content: center;
        }
      }
      /* --- Notification Section Improvements --- */

.notification-section {
  padding: 24px;
}

.notification-item {
  gap: 16px;
  padding: 18px 0;
}

.notification-item:not(:last-child) {
  border-bottom: 1px solid #f1f1f1;
}

.notification-content {
  max-width: calc(100% - 70px);
}

.notification-content h4 {
  font-size: 15px;
  margin-bottom: 6px;
}

.notification-content p {
  font-size: 13px;
  line-height: 1.5;
  color: #777;
}

/* Cleaner toggle */
.toggle-switch {
  width: 44px;
  height: 24px;
  border-radius: 14px;
  background-color: #e0e0e0;
  flex-shrink: 0;
}

.toggle-switch::after {
  width: 20px;
  height: 20px;
  top: 2px;
  left: 2px;
}

.toggle-switch.active {
  background-color: #20c997;
}

.toggle-switch.active::after {
  left: 22px;
}

/* Mobile breathing room */
@media (max-width: 480px) {
  .notification-item {
    align-items: flex-start;
  }

  .toggle-switch {
    margin-top: 4px;
  }
}

    </style>
  </head>

  <body>
    <!-- Header -->
    <nav class="navbar-custom">
      <div class="logo">
        <img src="/assets/images/mainlogotz.png" alt="">
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-content">
        <div class="hero-illustration">
          <img src="/assets/images/MAN WITHMAP.png" alt="">
        </div>
        <div class="hero-text">
          <h1>Save and plan your perfect trip</h1>
          <p><%= heroDescription || 'Organize your favorite places, create custom itineraries, and share your adventures effortlessly.' %></p>
        </div>
      </div>
    </section>

    <div class="main-container">
      <!-- Enable Location -->
      <div class="location-section">
        <div class="location-header">
          <i class="fas fa-map-marker-alt"></i>
          Enable Location Services
        </div>
        <p class="location-description">
          <%= locationText || 'Allow Wanderlust Explorer to access your location for personalized recommendations.' %>
        </p>
        <div class="search-box">
          <input type="text" id="locationInput" placeholder="Search for destinations or places...">
          <i class="fas fa-search"></i>
          <ul id="searchResults" class="list-group position-absolute w-100"></ul>


        </div>
        <div id="selectedLocation" class="mt-3"></div>
        <button class="btn-enable">Enable Location</button>
      </div>

      <!-- Interests -->
      <div class="interests-section">
        <div class="interests-header">What are your travel interests?</div>
        <div class="interests-tags">
          <% const interests = ['Adventure', 'Culture', 'Nature', 'Food & Drink', 'Historical', 'Art & Design', 'Family Fun', 'Shopping', 'All']; %>


          <% interests.forEach(interest => { %>
            <span class="tag <%= selectedInterests && selectedInterests.includes(interest) ? 'active' : '' %>"><%= interest %></span>
          <% }) %>
        </div>
      </div>

      <!-- Dates -->
      <!-- <div class="dates-section">
        <div class="dates-header"><i class="fas fa-calendar"></i> Travel Dates</div>
        <div class="dates-row">
          <div class="date-group">
            <label class="date-label">Travel Start Date</label>
            <div class="date-input"><i class="fas fa-calendar-alt"></i> <span><%= startDate || 'October 3rd, 2025' %></span></div>
          </div>
          <div class="date-group">
            <label class="date-label">Travel End Date</label>
            <div class="date-input"><i class="fas fa-calendar-alt"></i> <span><%= endDate || 'October 10th, 2025' %></span></div>
          </div>
        </div>
      </div> -->


      <!-- Dates -->
  <div class="dates-section">
    <div class="dates-header"><i class="fas fa-calendar"></i> Travel Dates</div>
    <div class="dates-row">
      <div class="date-group">
        <label class="date-label">Travel Start Date</label>
        <div class="date-input" id="openStartModal" style="cursor: pointer;">
          <i class="fas fa-calendar-alt"></i> 
          <span id="startDateText"><%= startDate || 'Select your start date' %></span>
        </div>
      </div>
      <div class="date-group">
        <label class="date-label">Travel End Date</label>
        <div class="date-input" id="openEndModal" style="cursor: pointer;">
          <i class="fas fa-calendar-alt"></i> 
          <span id="endDateText"><%= endDate || 'Select your end date' %></span>
        </div>
      </div>
    </div>
  </div>



      <!-- Notifications -->
      <div class="notification-section">
        <div class="notification-header">Notification Preferences</div>
        <% const notifications = [
          { title: 'New Discoveries & Tips', desc: 'Receive updates on new destinations and travel advice.', active: false },
          { title: 'Personalized Recommendations', desc: 'Get suggestions tailored to your interests and past trips.', active: false },
          { title: 'Trip Plan Reminders', desc: 'Alerts for upcoming trips and key planning milestones.', active: false }
        ]; %>
        <% notifications.forEach(note => { %>
          <div class="notification-item">
            <div class="notification-content">
              <h4><%= note.title %></h4>
              <p><%= note.desc %></p>
            </div>
            <div class="toggle-switch <%= note.active ? 'active' : '' %>" data-notification-type="<%= note.title.toLowerCase().replace(/ & /g, '-').split(' ')[0] %>"></div>
          </div>
        <% }) %>
      </div>

      <!-- Footer -->
      <div class="footer-section">
        <form action="/user/homepage" method="get">
          <button class="btn-get-started" id="getStartedBtn">Get Started</button>
        <a href="#" class="skip-link">Skip for now</a>
        </form>
      </div>
    </div>

  


    <!-- Start Date Modal -->
  <div class="modal fade" id="startDateModal" tabindex="-1" aria-labelledby="startDateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="startDateModalLabel">Select Start Date & Time</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <label class="form-label">Choose Date</label>
          <input type="date" id="startDate" class="form-control mb-3">

          <label class="form-label">Choose Time</label>
          <input type="time" id="startTime" class="form-control">
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-success" id="saveStartDate">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- End Date Modal -->
  <div class="modal fade" id="endDateModal" tabindex="-1" aria-labelledby="endDateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header border-0">
          <h5 class="modal-title" id="endDateModalLabel">Select End Date & Time</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <label class="form-label">Choose Date</label>
          <input type="date" id="endDate" class="form-control mb-3">

          <label class="form-label">Choose Time</label>
          <input type="time" id="endTime" class="form-control">
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-success" id="saveEndDate">Save</button>
        </div>
      </div>
    </div>
  </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // üåç Location Search with OpenStreetMap (India Only)
    const input = document.getElementById("locationInput");
    const resultsList = document.getElementById("searchResults");
    const selectedDiv = document.getElementById("selectedLocation");
    const enableLocationBtn = document.querySelector(".btn-enable");

    let timeout = null;

    input.addEventListener("input", () => {
      const query = input.value.trim();
      clearTimeout(timeout);

      if (query.length < 3) {
        resultsList.innerHTML = "";
        return;
      }

      timeout = setTimeout(async () => {
        try {
          const response = await fetch(
            `https://nominatim.openstreetmap.org/search?format=json&countrycodes=in&addressdetails=1&limit=5&q=${encodeURIComponent(query)}`,
            {
              headers: {
                "User-Agent": "TraveezyApp/1.0 (midl@example.com)", // Replace with your email or app name (required)
              },
            }
          );

          if (!response.ok) throw new Error("Network error while fetching location.");

          const data = await response.json();
          resultsList.innerHTML = "";

          if (data.length === 0) {
            const noResult = document.createElement("li");
            noResult.classList.add("list-group-item", "text-muted");
            noResult.textContent = "No locations found in India.";
            resultsList.appendChild(noResult);
            return;
          }

          data.forEach((loc) => {
            const li = document.createElement("li");
            li.classList.add("list-group-item", "list-group-item-action");
            li.textContent = loc.display_name;

            li.addEventListener("click", () => {
              input.value = loc.display_name;
              resultsList.innerHTML = "";
              selectedDiv.innerHTML = `
                <div class="alert alert-info mt-2">
                  <strong>Selected Location:</strong><br>
                  ${loc.display_name}<br>
                  <strong>Latitude:</strong> ${loc.lat} | <strong>Longitude:</strong> ${loc.lon}
                </div>
              `;
            });

            resultsList.appendChild(li);
          });
        } catch (error) {
          console.error("Error fetching locations:", error);
          resultsList.innerHTML = `<li class="list-group-item text-danger">‚ö†Ô∏è Failed to fetch locations.</li>`;
        }
      }, 300);
    });

    // üìç Enable Geolocation
    enableLocationBtn.addEventListener("click", () => {
      if (!navigator.geolocation) {
        alert("‚ùå Geolocation is not supported by your browser.");
        return;
      }

      enableLocationBtn.textContent = "Fetching your location...";
      enableLocationBtn.disabled = true;

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;

          try {
            const response = await fetch(
              `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`,
              {
                headers: {
                  "User-Agent": "TraveezyApp/1.0 (midl@example.com)",
                },
              }
            );

            if (!response.ok) throw new Error("Reverse geocoding failed.");

            const data = await response.json();
            const placeName = data.display_name || "Unknown location";

            selectedDiv.innerHTML = `
              <div class="alert alert-success mt-3">
                <strong>‚úÖ Location Enabled!</strong><br>
                ${placeName}<br>
                <strong>Latitude:</strong> ${lat.toFixed(6)} |
                <strong>Longitude:</strong> ${lon.toFixed(6)}
              </div>
            `;
            input.value = placeName;

            enableLocationBtn.textContent = "Location Enabled";
            enableLocationBtn.style.backgroundColor = "#1aa179";
          } catch (error) {
            console.error("Error reverse geocoding:", error);
            selectedDiv.innerHTML = `<div class="alert alert-danger mt-3">‚ö†Ô∏è Unable to fetch location details.</div>`;
            enableLocationBtn.textContent = "Enable Location";
            enableLocationBtn.disabled = false;
          }
        },
        (error) => {
          const messages = {
            1: "‚ùå Permission denied.",
            2: "‚ö†Ô∏è Position unavailable.",
            3: "‚è≥ Timeout.",
          };
          selectedDiv.innerHTML = `<div class="alert alert-danger mt-3">${messages[error.code] || "‚ö†Ô∏è Unknown error."}</div>`;
          enableLocationBtn.textContent = "Enable Location";
          enableLocationBtn.disabled = false;
        },
        { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
      );
    });

    // üéØ Travel Interests Toggle
    const allInterestTags = document.querySelectorAll(".interests-tags .tag");
    const allButton = Array.from(allInterestTags).find(tag => tag.textContent.trim() === 'All');
    const otherTags = Array.from(allInterestTags).filter(tag => tag.textContent.trim() !== 'All');

    allInterestTags.forEach(tag => {
      tag.addEventListener("click", () => {
        const isAllButton = tag.textContent.trim() === 'All';

        if (isAllButton) {
          // Toggle 'All' button and apply its state to all other tags
          const isActive = allButton.classList.toggle('active');
          otherTags.forEach(other => {
            isActive ? other.classList.add('active') : other.classList.remove('active');
          });
        } else {
          // Toggle the individual tag
          tag.classList.toggle('active');
          
          // Check if all other tags are active to update the 'All' button state
          const allOthersActive = otherTags.every(t => t.classList.contains('active'));
          allOthersActive ? allButton.classList.add('active') : allButton.classList.remove('active');
        }
      });
    });

    // üîî Notification Toggle
    document.querySelectorAll(".toggle-switch").forEach((toggle) => {
      toggle.addEventListener("click", () => toggle.classList.toggle("active"));
    });

    // ÔøΩ Date Modal Handling
    document.getElementById("openStartModal").addEventListener("click", () => {
      new bootstrap.Modal(document.getElementById("startDateModal")).show();
    });
    document.getElementById("openEndModal").addEventListener("click", () => {
      new bootstrap.Modal(document.getElementById("endDateModal")).show();
    });

    document.getElementById("saveStartDate").addEventListener("click", () => {
      const date = document.getElementById("startDate").value;
      const time = document.getElementById("startTime").value;
      if (!date || !time) return alert("Please select both date and time.");
      document.getElementById("startDateText").textContent = new Date(
        `${date}T${time}`
      ).toLocaleString("en-US", { dateStyle: "medium", timeStyle: "short" });
      bootstrap.Modal.getInstance(document.getElementById("startDateModal")).hide();
    });

    document.getElementById("saveEndDate").addEventListener("click", () => {
      const date = document.getElementById("endDate").value;
      const time = document.getElementById("endTime").value;
      if (!date || !time) return alert("Please select both date and time.");
      document.getElementById("endDateText").textContent = new Date(
        `${date}T${time}`
      ).toLocaleString("en-US", { dateStyle: "medium", timeStyle: "short" });
      bootstrap.Modal.getInstance(document.getElementById("endDateModal")).hide();
    });


    document.getElementById("getStartedBtn").addEventListener("click", async (event) => {
      // Prevent the default form submission to handle validation first
      event.preventDefault();

      // üìç Location
      const locationInput = document.getElementById("locationInput");
      const location = locationInput.value;
      let latitude = null;
      let longitude = null;

      if (selectedDiv.innerHTML.includes("Latitude:")) {
        const locationText = selectedDiv.textContent;
        latitude = parseFloat(locationText.match(/Latitude:\s*([-\d.]+)/)[1]);
        longitude = parseFloat(locationText.match(/Longitude:\s*([-\d.]+)/)[1]);
      }

      // üó∫Ô∏è Interests
      const interestTags = document.querySelectorAll(".tag.active");
      const interests = Array.from(interestTags).map((tag) => tag.textContent);
      // Filter out 'All' if it's present, as it's a UI helper, not a data point.
      const finalInterests = interests.filter(i => i !== 'All');

      // üìÖ Dates
      const startDateText = document.getElementById("startDateText").textContent;
      const endDateText = document.getElementById("endDateText").textContent;


      // üîî Notifications
      const notificationToggles = document.querySelectorAll(".toggle-switch");
      const notificationSettings = {};
      notificationToggles.forEach(toggle => {
        const type = toggle.getAttribute('data-notification-type');
        // Use a mapping if needed, for now, we'll use a simplified key.
        notificationSettings[type] = toggle.classList.contains('active');
      });

      // --- VALIDATION ---
      if (!location || !latitude || !longitude) {
        alert("Please select a location from the search results or enable location services.");
        return;
      }
      if (finalInterests.length === 0) {
        alert("Please select at least one travel interest.");
        return;
      }
      if (startDateText === 'Select your start date' || endDateText === 'Select your end date') {
        alert("Please select both a travel start and end date.");
        return;
      }
      // --- END VALIDATION ---

      // üì° Send data to backend
      const startDate = startDateText === "Select your start date" ? null : new Date(startDateText).toISOString();
      const endDate = endDateText === "Select your end date" ? null : new Date(endDateText).toISOString();


      try {
        const response = await fetch("/user/save-onboarding", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            location,
            latitude,
            longitude,
            interests: finalInterests,
            startDate,
            endDate,
            notifications: notificationSettings,
          }),
        });

        const data = await response.json();
        if (response.ok) {
          window.location.href = "/user/homepage"; // Redirect on success
        } else {
          alert("Error saving data: " + data.message);
        }
      } catch (error) {
        console.error("Error:", error);
        alert("An error occurred while saving. Please try again.");
      }
    });
  </script>

    
  </body>
  </html>